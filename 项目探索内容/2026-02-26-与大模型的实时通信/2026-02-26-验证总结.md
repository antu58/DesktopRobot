# 2026-02-26 验证总结

## 1. 今日完成

1. ASR：完成单路流式识别链路（浏览器麦克风 -> WebRTC -> Go -> FunASR -> 实时字幕）。
2. TTS：完成 CosyVoice 本地服务化，支持预置音色与复刻音色。
3. 复刻：支持上传 `m4a` 参考音频创建 `clone_id`，并可持续复用。
4. 流式：新增真流式接口 `/api/synthesize/clone/stream` 与测试页 `/stream-test`。
5. 部署：固定端口、Docker 启动、镜像缓存优先策略已落地。

## 2. 关键验证结果

1. `clone_id` 创建成功，且可查询与复用（已验证 `test_clone_01` / `my_clone_01`）。
2. 真流式接口返回 `Transfer-Encoding: chunked`，数据格式为 `pcm_s16le`。
3. 接口首包时间（TTFB）在本地验证约 `0.016s`，链路确认为“单次请求持续回传”。
4. 端到端听感仍不连续，核心瓶颈是 CPU 推理速度，不是前端播放逻辑。

## 3. 当前配置（本地）

1. ASR 页面与信令：`18188/tcp`
2. ASR WebRTC ICE：`19188/udp`
3. CosyVoice 服务：`18388/tcp`

## 4. 主要问题与原因

1. 长文本与短句都存在较长推理等待时间（CPU 模式下 RTF 偏高）。
2. 每次容器重启仍会看到部分模型元信息检查请求（并非完整重下权重）。
3. 当前流式已是真流式传输，但“说话连续性”仍受模型推理算力限制。

## 5. 下一步建议（按优先级）

1. 上 GPU 路径（优先）并重新测首包时延、连续性、打断恢复。
2. 将 ASR->LLM->TTS 接成单通道实时编排，做“说到一半纠正（呃不）”联调。
3. 增加 barge-in 控制（停止当前播报并切换到新意图）。
4. 统一指标面板：首包时延、端到端时延、RTF、成功率。
