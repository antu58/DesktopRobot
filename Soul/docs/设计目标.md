# Soul 设计目标

更新时间：2026-02-22

## 1. 目标定位

Soul 负责机器人“灵魂”侧能力，核心职责是：

- 管理终端与灵魂绑定（`terminal_id -> soul_id`）
- 基于上下文组织 LLM 推理
- 根据终端技能快照调度动作执行
- 保障对话主链路实时性
- 维护会话压缩与异步记忆流程

## 2. 核心设计原则

1. 主链路优先实时：聊天请求不依赖 Mem0 同步读写。  
2. 协议单一来源：通信字段以 `../../doc/通信协议-v2.md` 为准。  
3. 输入标准化：统一走 `inputs[]`，当前 Phase 1 主输入为 `keyboard_text` 与 `speech_text`。  
4. 技能由终端驱动：技能定义来自 MQTT `skills` 快照，不写死在业务库。  
5. 空闲触发总结：连续 3 分钟无新输入触发摘要与异步记忆任务。

## 3. 运行流程（当前）

1. 用户先创建灵魂并绑定终端（`/v1/souls`、`/v1/souls/select`）。  
2. 终端连接后上报 `online + skills + intent_catalog + heartbeat`。  
3. 业务侧调用 `POST /v1/chat`（见 `API文档-Soul服务.md`）。  
4. Soul 先做用户情绪识别并更新灵魂 PAD，发布 `emotion_update`。  
5. Soul 调 intent-filter，命中可执行意图时发布 `intent_action`。  
6. 未命中意图时进入 LLM 工具编排；若触发 `recall_memory` 则走二轮推理，且每轮调用前都即时注入当刻情绪快照关键词。  
7. 入库消息并按阈值进行会话压缩；空闲达到阈值后触发异步总结流程。

## 4. 当前阶段边界（Phase 1）

- 已支持：`inputs[]` 协议、`keyboard_text/speech_text` 主链路、意图下发、技能调度、会话压缩、空闲总结。  
- 未完全支持：`audio/image/video/sensor_state` 主链路解析（结构已预留）。

## 5. 关联文档

- API：`API文档-Soul服务.md`
- 人格系统方案：`灵魂人格系统-v2-设计方案.md`
- 技术调研：`技术调研.md`
- 全局协议：`../../doc/通信协议-v2.md`
