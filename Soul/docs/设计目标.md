# Soul 设计目标

更新时间：2026-02-20

## 1. 目标定位

Soul 负责机器人“灵魂”侧能力，核心职责是：

- 管理终端与灵魂绑定（`terminal_id -> soul_id`）
- 基于上下文组织 LLM 推理
- 根据终端技能快照调度动作执行
- 保障对话主链路实时性
- 维护会话压缩与异步记忆流程

## 2. 核心设计原则

1. 主链路优先实时：聊天请求不依赖 Mem0 同步读写。  
2. 协议单一来源：通信字段以 `../../doc/通信协议-v2.md` 为准。  
3. 输入标准化：统一走 `inputs[]`，当前 Phase 1 主输入为 `keyboard_text`。  
4. 技能由终端驱动：技能定义来自 MQTT `skills` 快照，不写死在业务库。  
5. 空闲触发总结：连续 3 分钟无新输入触发摘要与异步记忆任务。

## 3. 运行流程（当前）

1. 终端连接后上报 `online + skills + heartbeat`。  
2. 业务侧调用 `POST /v1/chat`（见 `API文档-Soul服务.md`）。  
3. Soul 组装提示词：灵魂画像 + 历史摘要 + 本轮输入。  
4. LLM 返回回复与技能调用建议。  
5. Soul 通过 MQTT 下发技能并收结果。  
6. 入库消息并按阈值进行会话压缩。  
7. 空闲达到阈值后触发异步总结流程。

## 4. 当前阶段边界（Phase 1）

- 已支持：`inputs[]` 协议、`keyboard_text` 主链路、技能调度、会话压缩、空闲总结。  
- 未完全支持：`audio/image/video/sensor_state` 主链路解析（结构已预留）。

## 5. 关联文档

- API：`API文档-Soul服务.md`
- 技术调研：`技术调研.md`
- 全局协议：`../../doc/通信协议-v2.md`
