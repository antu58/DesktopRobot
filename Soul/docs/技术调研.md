# Soul 技术调研

更新时间：2026-02-20

## 1. 技术栈结论

- 语言与服务：Go（`soul-server` + `terminal-web`）
- 消息通信：MQTT（设备在线、心跳、技能快照、技能调用与回执）
- 数据持久化：PostgreSQL
- LLM 接入：OpenAI 兼容接口 + Claude
- 记忆策略：本地会话摘要为主，Mem0 仅异步路径

## 2. 架构拆分

- `soul-server`：协议入口、编排、记忆、MQTT 调度
- `terminal-web`：调试终端（模拟技能上报与执行）
- `memory`：会话摘要压缩、空闲扫描、异步队列
- `skills registry`：终端技能快照缓存与版本控制

## 3. 关键实现点

### 3.1 技能版本机制

- 终端通过 `skill_version` 上报能力快照。
- 服务端拒绝旧版本回滚，保证能力单调演进。

### 3.2 会话压缩策略

- 阈值触发（消息数/字符数）避免每轮压缩。
- 空闲扫描任务按会话活跃时间批量执行。

### 3.3 活跃判定策略

- 当前活跃信号仅来自 `/v1/chat` 新输入。
- 成功写入用户消息即刷新 3 分钟计时。

## 4. 风险与后续方向

- 多模态输入尚未主链路接入，需要独立标准化服务（ASR/VLM/视频摘要）。
- 技能参数 JSON Schema 仍依赖终端自律，后续可增加服务端校验层。
- 会话压缩质量受模型稳定性影响，后续可补评估指标与回归集。

## 5. 关联文档

- 设计目标：`设计目标.md`
- API：`API文档-Soul服务.md`
- 全局协议：`../../doc/通信协议-v2.md`
