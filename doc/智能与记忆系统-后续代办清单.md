# 智能与记忆系统后续代办清单

更新时间：2026-02-25
状态：执行中

## 目标
将当前“人格 + 情绪 + 记忆”设计从可用版本，推进到可持续迭代、可评估、可治理的工程化版本。

## 优先级总览
- P0（近期重点）：记忆写入治理、记忆可追溯与冲突解决、系统级评测框架
- P1（第二阶段）：记忆安全与权限、程序性记忆、上下文预算管理、情绪显著化体验优化
- P2（第三阶段）：多模态情绪输入增强

## P0 代办（必须优先）

### 1. 记忆写入治理策略落地
- [ ] 定义记忆写入策略矩阵（热路径写入/异步写入/不写入）
- [ ] 为每类记忆配置写入阈值（常量式、短期、长期关键、逻辑、资料目录）
- [ ] 建立噪声拦截规则（低价值重复信息不入库）
- [ ] 增加写入决策日志（为什么写/为什么不写）
- [ ] 对接现有链路（`Soul/internal/memory`、`Soul/internal/orchestrator`）
- 完成标准：写入延迟和噪声率可观测，且策略可配置、可灰度

### 2. 记忆可追溯与冲突解决
- [ ] 为记忆统一补充元数据（来源、时间戳、置信度、版本）
- [ ] 新增冲突检测（同一事实多版本）
- [ ] 定义冲突仲裁规则（新鲜度优先/可信源优先/人工确认）
- [ ] 提供冲突可解释输出（返回“采用了哪条、为什么”）
- [ ] 补充回归测试（冲突场景、更新场景、回滚场景）
- 完成标准：同事实冲突时结果稳定且可解释

### 3. 系统级评测框架（Evals）
- [ ] 建立评测数据集（人格一致性、情绪稳定性、记忆召回、误召回）
- [ ] 定义核心指标：
  - [ ] 人格一致性分
  - [ ] 情绪识别误差与门控误杀率
  - [ ] 关键记忆命中率/误召回率
  - [ ] 漂移越界率（`drift` 是否超预期）
- [ ] 建立离线评测脚本与每周基线报告
- [ ] 建立上线前门禁（核心指标未达标禁止发布）
- 完成标准：每次迭代可量化对比“是否真的变好”

## P1 代办（第二阶段）

### 4. 记忆安全与权限治理
- [ ] 按记忆类型定义读写权限（系统/用户/工具）
- [ ] 增加敏感记忆写入确认机制（必要时二次确认）
- [ ] 支持按类型删除、过期、审计追踪
- [ ] 输出安全策略文档与误用演练清单
- 完成标准：记忆层具备最小权限和可审计能力

### 5. 程序性记忆（Procedural Memory）
- [ ] 抽象“怎么做事”的可复用流程模板
- [ ] 建立流程版本管理（升级、回滚、弃用）
- [ ] 将高频任务沉淀为程序性记忆单元
- [ ] 验证长期任务稳定性收益（减少重复解释）
- 完成标准：至少 3 个高频任务可复用且稳定执行

### 6. 上下文预算管理器
- [ ] 实现上下文分层注入策略（硬约束 > 长期关键 > 普通背景）
- [ ] 增加动态压缩和淘汰策略（按 token 预算）
- [ ] 实现召回优先级排序（相关性 + 新鲜度 + 可信度）
- [ ] 对接 LLM 请求链路并记录注入决策
- 完成标准：上下文超限场景下仍能稳定命中关键信息

### 7. 情绪显著化体验优化（暂不实施，待排期）
- [ ] 即时层（0~10 秒）显著化：每轮先返回“情绪镜像 + 任务响应”双段式回复
- [ ] 即时层动作增强：`emotion_update` 映射到更明显的表情/头部动作/语气速度，且状态保持 8~15 秒
- [ ] 即时层防抖：限制高频情绪切换，避免 2~3 秒内反复抖动
- [ ] 会话层一致性：同一会话维持情绪基线，减少回复风格随机漂移
- [ ] 会话层执行策略联动：`exec_mode=blocked` 时给出用户可理解的解释与恢复条件
- [ ] 长期层轻量记忆：仅沉淀情绪事件摘要，下一会话首轮最多引用 1 条
- [ ] 建立体验指标：情绪可感知率、用户主观一致性评分、误触发/过度表达率
- 完成标准：新用户在 1~3 轮内能明显感知情绪差异，且不会出现“情绪噪声”或打断任务主线

## P2 代办（第三阶段）

### 8. 多模态情绪输入增强
- [ ] 引入语音韵律特征（语速、停顿、能量）
- [ ] 建立文本+语音融合策略与置信度融合规则
- [ ] 建立多模态误差分析数据集
- [ ] 对比单文本方案的真实收益（准确率、误判率）
- 完成标准：关键场景情绪识别误判率显著下降

## 里程碑建议
- M1（2~3 周）：完成 P0-1 写入治理
- M2（4~6 周）：完成 P0-2 冲突治理 + P0-3 评测基线
- M3（6~10 周）：推进 P1 四项能力并稳定上线
- M4（10 周+）：推进 P2 多模态情绪能力

## 本周可立即启动（建议）
- [ ] 先完成“写入策略矩阵”初版（先有规则，再做工程细化）
- [ ] 先补“记忆元数据 schema”与冲突字段
- [ ] 先搭“最小评测集”与每周自动报告
